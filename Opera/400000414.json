{"SQLID":400000414,"OperationSQL":"/* Operation Name :  Load To Input \n Add Rule Description here.*/\n \r\n--Alter Table SLAM_DETAIL\r\n--Add ACTIVITY_IDENTIFIER Varchar(20)\r\n--,NHSE_POD_CODE Varchar(20)\r\n\r\n--Alter Table SLAM_DETAIL\r\n--Add ACTIVITY_IDENTIFIER Varchar(20)\r\n--,NHSE_POD_CODE Varchar(20)\r\nTruncate Table INP_ACM_PATIENT_LEVEL_OP_UNB\r\nGo\r\nInsert Into INP_ACM_PATIENT_LEVEL_OP_UNB\r\n(\r\n\t[ROW_ID]\r\n\t,[DATE_ENTERED]\r\n\t,[RECORD_ID]\r\n\t,[SYSTEM_ID]\r\n\t,[SUS_ACTIVITY_ID]\r\n\t,[ACTIVITY_IDENTIFIER]\r\n\t,[ENCNTR_ID]\r\n\t,[EPISODE_NUMBER]\r\n\t,[SITE]\r\n\t,[SPECIALTY_CODE_MAIN]\r\n\t,[SPECIALTY_CODE_LOCAL]\r\n\t,[SPECIALTY_CODE_SUB]\r\n\t,[ACTIVITY_TREATMENT_FUNCTION_CODE]\r\n\t,[ACTIVITY_TREATMENT_FUNCTION_CODE_LOCAL]\r\n\t,[CONSULTANT_CODE]\r\n\t,[HA_CODE]\r\n\t,[ORIGINATING_CCG_CODE]\r\n\t,[COMMISSIONER_CODE]\r\n\t,[COMMISSIONER_CODE_LOCAL]\r\n\t,[COMMISSIONER_CODE_ORIGINAL]\r\n\t,[REGISTERED_PRACTICE_CODE]\r\n\t,[CONTRACT_CODE]\r\n\t,[POD_CODE_LOCAL]\r\n\t,[POD_CODE_NHSE]\r\n\t,[HRG_CODE]\r\n\t,[HRG_CODE_LOCAL]\r\n\t,[UNBUNDLED_HRG_CODE]\r\n\t,[ATTENDANCE_HRG]\r\n\t,[SPELL_REPORT_FLAG]\r\n\t,[ACTIVITY_DATE_TIME]\r\n\t,[ACTIVITY_DATE_ID]\r\n\t,[ACTIVITY_DATE]\r\n\t,[ACTIVITY_VOLUME]\r\n\t,[SLID_CODE]\r\n\t,[SLID_CODE_LOCAL]\r\n\t,[NPOC]\r\n\t,[NPOC_LOCAL]\r\n\t,[TARGET_CODE]\r\n\t,[SPECSERVICE_ID]\r\n\t,[SPECSERVICE_ID_2]\r\n\t,[SPECSERVICE_ID_3]\r\n\t,[SPECSERVICE_ID_4]\r\n\t,[SPECSERVICE_ID_5]\r\n\t,[SPECSERVICE_ID_6]\r\n\t,[SPECSERVICE_ID_7]\r\n\t,[SPECSERVICE_ID_8]\r\n\t,[SPECSERVICE_ID_9]\r\n\t,[SPECSERVICE_ID_10]\r\n\t,[SPECSERVICE_ID_11]\r\n\t,[SPECSERVICE_ID_12]\r\n\t,[SPECSERVICE_ID_13]\r\n\t,[SPECSERVICE_ID_14]\r\n\t,[SPECSERVICE_ID_15]\r\n\t,[SPECSERVICE_ID_16]\r\n\t,[SPECSERVICE_ID_17]\r\n\t,[SPECSERVICE_ID_18]\r\n\t,[SPECSERVICE_ID_19]\r\n\t,[SPECSERVICE_ID_20]\r\n\t,[SPECSERVICE_ID_21]\r\n\t,[LENGTH_OF_SPELL]\r\n\t,[LENGTH_OF_EPISODE]\r\n\t,[TRIMPOINT_EL]\r\n\t,[TRIMPOINT_NEL]\r\n\t,[EXCESS_BED_DAYS_EL]\r\n\t,[EXCESS_BED_DAYS_NEL]\r\n\t,[EXCESS_BED_DAYS]\r\n\t,[REPORT_MASTER_ID]\r\n\t,[USER_DEFINED_ACTIVITY_CODE_01]\r\n\t,[USER_DEFINED_ACTIVITY_CODE_02]\r\n\t,[USER_DEFINED_ACTIVITY_CODE_03]\r\n\t,[ADMISSION_DATE_TIME]\r\n\t,[ADMISSION_DATE]\r\n\t,[ADMISSION_DATE_ID]\r\n\t,[DISCHARGE_DATE_TIME]\r\n\t,[DISCHARGE_DATE]\r\n\t,[DISCHARGE_DATE_ID]\r\n\t,[EPISODE_START_DATE_TIME]\r\n\t,[EPISODE_START_DATE]\r\n\t,[EPISODE_START_DATE_ID]\r\n\t,[EPISODE_END_DATE_TIME]\r\n\t,[EPISODE_END_DATE]\r\n\t,[EPISODE_END_DATE_ID]\r\n\t,[PATIENT_CLASS_CODE]\r\n\t,[ADMISSION_METHOD_CODE]\r\n\t,[INTENDED_MANAGEMENT_CODE]\r\n\t,[FIRST_REGULAR_DAY_OR_NIGHT_ADMISSION]\r\n\t,[WEIGHT]\r\n\t,[IS_READMISSION]\r\n\t,[READMISSION_DAYS]\r\n\t,[SERVICE_LINE_CODE]\r\n\t,[PERSON_ID]\r\n\t,[HOSPITAL_NUMBER]\r\n\t,[NHS_NUMBER]\r\n\t,[AGE_AT_ACTIVITY_DATE]\r\n\t,[DATE_OF_BIRTH]\r\n\t,[PATIENT_GENDER]\r\n\t,[PATIENT_POSTCODE]\r\n\t,[CLINIC_CODE]\r\n\t,[WARD_CODE_ADMISSION]\r\n\t,[WARD_CODE_DISCHARGE]\r\n\t,[ICD10_CODE]\r\n\t,[OPCS_CODE]\r\n\t,[USER_DEFINED_ACTUAL_ACTIVITY_CODE_01]\r\n\t,[USER_DEFINED_ACTUAL_ACTIVITY_CODE_02]\r\n\t,[USER_DEFINED_ACTUAL_ACTIVITY_CODE_03]\r\n\t,[USER_DEFINED_ACTUAL_ACTIVITY_CODE_04]\r\n\t,[USER_DEFINED_ACTUAL_ACTIVITY_CODE_05]\r\n\t,[PSEUDONYMISED_REPORT_MASTER_ID]\r\n\t,[REFERRAL_SOURCE_CODE]\r\n\t,[PATHWAY_ID]\r\n\t,[SERVICE_CLASS_CODE]\r\n\t,[MOD_FLAG]\r\n\t,[MOD_FLAG_LOCAL]\r\n\t,[JUSTICE_FLAG]\r\n\t,[JUSTICE_FLAG_LOCAL]\r\n\t,[SPECIALIST_FLAG]\r\n\t,[SPECIALIST_FLAG_LOCAL]\r\n\t,[PBR]\r\n\t,[APPOINTMENT_TYPE]\r\n\t,[FIRST_ATTENDANCE_CODE]\r\n\t,[ATTENDED_OR_DID_NOT_ATTEND_CODE]\r\n\t,[PRIMARY_PROCEDURE]\r\n\t,[ALL_PROCEDURES]\r\n\t,[APPOINTMENT_FILTER]\r\n\t,[REPORT_GROUP]\r\n\t,[PRIMARY_DIAGNOSIS]\r\n\t,[ALL_DIAGNOSES]\r\n\t,[CCP_TYPE]\r\n\t,[CRITICAL_CARE_START_DATE_TIME]\r\n\t,[CRITICAL_CARE_START_DATE_ID]\r\n\t,[CRITICAL_CARE_DISCHARGE_DATE_TIME]\r\n\t,[CRITICAL_CARE_DISCHARGE_DATE_ID]\r\n\t,[CRITICAL_CARE_ACTIVITY_DATE]\r\n\t,[CRITICAL_CARE_ACTIVITY_DATE_ID]\r\n\t,[CRITICAL_CARE_UNIT_FUNCTION]\r\n\t,[ALL_CRITICAL_CARE_ACTIVITY_CODES]\r\n\t,[CRITICAL_CARE_LOCAL_ID]\r\n\t,[OVERSEAS_VISITOR_STATUS]\r\n\t,[STATUS]\r\n\t,[ADMINISTRATIVE_CATEGORY_CODE]\r\n\t,[DATA_QUALITY_FLAG]\r\n\t,[LOCAL_FLAG]\r\n\t,[PATHWAY_TYPE]\r\n\t,[CONSULTANT_NAME]\r\n\t,[CHANGE_LOG]\r\n\t,[WARD_NAME_ADMISSION]\r\n\t,[WARD_NAME_DISCHARGE]\r\n\t,[CRITICAL_CARE_BED_DAYS]\r\n\t,[REHAB_BED_DAYS]\r\n\t,[EXCESS_BED_DAYS_ADJUSTED]\r\n\t,[PRIVATE_PATIENT_FLAG]\r\n\t,[CURRENT_PERMANENT_RESIDENCE_UK_FLAG]\r\n\t,[OVERSEAS_VISITOR_CHARGEABLE_FLAG]\r\n\t,[OVERSEAS_VISITOR_NONCHARGEABLE_FLAG]\r\n\t,[PAYING_PATIENT_FLAG]\r\n)\r\nSELECT \r\n\tacm.[ROW_ID]\r\n\t,acm.[DATE_ENTERED]\r\n\t,acm.[RECORD_ID]\r\n\t,acm.[SYSTEM_ID]\r\n\t,acm.[SUS_ACTIVITY_ID]\r\n\t,acm.[ACTIVITY_IDENTIFIER]\r\n\t,acm.[ENCNTR_ID]\r\n\t,acm.[EPISODE_NUMBER]\r\n\t,acm.[SITE]\r\n\t,acm.[SPECIALTY_CODE_MAIN]\r\n\t,acm.[SPECIALTY_CODE_LOCAL]\r\n\t,acm.[SPECIALTY_CODE_SUB]\r\n\t,acm.[ACTIVITY_TREATMENT_FUNCTION_CODE]\r\n\t,acm.[ACTIVITY_TREATMENT_FUNCTION_CODE_LOCAL]\r\n\t,acm.[CONSULTANT_CODE]\r\n\t,acm.[HA_CODE]\r\n\t,acm.[ORIGINATING_CCG_CODE]\r\n\t,acm.[COMMISSIONER_CODE]\r\n\t,acm.[COMMISSIONER_CODE_LOCAL]\r\n\t,acm.[COMMISSIONER_CODE_ORIGINAL]\r\n\t,acm.[REGISTERED_PRACTICE_CODE]\r\n\t,acm.[CONTRACT_CODE]\r\n\t,acm.[POD_CODE_LOCAL]\r\n\t,acm.[POD_CODE_NHSE]\r\n\t,acm.[HRG_CODE]\r\n\t,acm.[HRG_CODE_LOCAL]\r\n\t,convert(varchar(255),null) [UNBUNDLED_HRG_CODE]  --unb.UnbundledHRGs\r\n\t,acm.[ATTENDANCE_HRG]\r\n\t,acm.[SPELL_REPORT_FLAG]\r\n\t,acm.[ACTIVITY_DATE_TIME]\r\n\t,acm.[ACTIVITY_DATE_ID]\r\n\t,acm.[ACTIVITY_DATE]\r\n\t,acm.[ACTIVITY_VOLUME]\r\n\t,acm.[SLID_CODE]\r\n\t,acm.[SLID_CODE_LOCAL]\r\n\t,acm.[NPOC]\r\n\t,acm.[NPOC_LOCAL]\r\n\t,acm.[TARGET_CODE]\r\n\t,acm.[SPECSERVICE_ID]\r\n\t,acm.[SPECSERVICE_ID_2]\r\n\t,acm.[SPECSERVICE_ID_3]\r\n\t,acm.[SPECSERVICE_ID_4]\r\n\t,acm.[SPECSERVICE_ID_5]\r\n\t,acm.[SPECSERVICE_ID_6]\r\n\t,acm.[SPECSERVICE_ID_7]\r\n\t,acm.[SPECSERVICE_ID_8]\r\n\t,acm.[SPECSERVICE_ID_9]\r\n\t,acm.[SPECSERVICE_ID_10]\r\n\t,acm.[SPECSERVICE_ID_11]\r\n\t,acm.[SPECSERVICE_ID_12]\r\n\t,acm.[SPECSERVICE_ID_13]\r\n\t,acm.[SPECSERVICE_ID_14]\r\n\t,acm.[SPECSERVICE_ID_15]\r\n\t,acm.[SPECSERVICE_ID_16]\r\n\t,acm.[SPECSERVICE_ID_17]\r\n\t,acm.[SPECSERVICE_ID_18]\r\n\t,acm.[SPECSERVICE_ID_19]\r\n\t,acm.[SPECSERVICE_ID_20]\r\n\t,acm.[SPECSERVICE_ID_21]\r\n\t,acm.[LENGTH_OF_SPELL]\r\n\t,acm.[LENGTH_OF_EPISODE]\r\n\t,acm.[TRIMPOINT_EL]\r\n\t,acm.[TRIMPOINT_NEL]\r\n\t,acm.[EXCESS_BED_DAYS_EL]\r\n\t,acm.[EXCESS_BED_DAYS_NEL]\r\n\t,acm.[EXCESS_BED_DAYS]\r\n\t,acm.[REPORT_MASTER_ID]\r\n\t,acm.[USER_DEFINED_ACTIVITY_CODE_01]\r\n\t,acm.[USER_DEFINED_ACTIVITY_CODE_02]\r\n\t,acm.[USER_DEFINED_ACTIVITY_CODE_03]\r\n\t,acm.[ADMISSION_DATE_TIME]\r\n\t,acm.[ADMISSION_DATE]\r\n\t,acm.[ADMISSION_DATE_ID]\r\n\t,acm.[DISCHARGE_DATE_TIME]\r\n\t,acm.[DISCHARGE_DATE]\r\n\t,acm.[DISCHARGE_DATE_ID]\r\n\t,acm.[EPISODE_START_DATE_TIME]\r\n\t,acm.[EPISODE_START_DATE]\r\n\t,acm.[EPISODE_START_DATE_ID]\r\n\t,acm.[EPISODE_END_DATE_TIME]\r\n\t,acm.[EPISODE_END_DATE]\r\n\t,acm.[EPISODE_END_DATE_ID]\r\n\t,acm.[PATIENT_CLASS_CODE]\r\n\t,acm.[ADMISSION_METHOD_CODE]\r\n\t,acm.[INTENDED_MANAGEMENT_CODE]\r\n\t,acm.[FIRST_REGULAR_DAY_OR_NIGHT_ADMISSION]\r\n\t,acm.[WEIGHT]\r\n\t,acm.[IS_READMISSION]\r\n\t,acm.[READMISSION_DAYS]\r\n\t,acm.[SERVICE_LINE_CODE]\r\n\t,acm.[PERSON_ID]\r\n\t,acm.[HOSPITAL_NUMBER]\r\n\t,acm.[NHS_NUMBER]\r\n\t,acm.[AGE_AT_ACTIVITY_DATE]\r\n\t,acm.[DATE_OF_BIRTH]\r\n\t,acm.[PATIENT_GENDER]\r\n\t,acm.[PATIENT_POSTCODE]\r\n\t,acm.[CLINIC_CODE]\r\n\t,acm.[WARD_CODE_ADMISSION]\r\n\t,acm.[WARD_CODE_DISCHARGE]\r\n\t,acm.[ICD10_CODE]\r\n\t,acm.[OPCS_CODE]\r\n\t,acm.[USER_DEFINED_ACTUAL_ACTIVITY_CODE_01]\r\n\t,acm.[USER_DEFINED_ACTUAL_ACTIVITY_CODE_02]\r\n\t,acm.[USER_DEFINED_ACTUAL_ACTIVITY_CODE_03]\r\n\t,acm.[USER_DEFINED_ACTUAL_ACTIVITY_CODE_04]\r\n\t,acm.[USER_DEFINED_ACTUAL_ACTIVITY_CODE_05]\r\n\t,acm.[PSEUDONYMISED_REPORT_MASTER_ID]\r\n\t,acm.[REFERRAL_SOURCE_CODE]\r\n\t,acm.[PATHWAY_ID]\r\n\t,acm.[SERVICE_CLASS_CODE]\r\n\t,acm.[MOD_FLAG]\r\n\t,acm.[MOD_FLAG_LOCAL]\r\n\t,acm.[JUSTICE_FLAG]\r\n\t,acm.[JUSTICE_FLAG_LOCAL]\r\n\t,acm.[SPECIALIST_FLAG]\r\n\t,acm.[SPECIALIST_FLAG_LOCAL]\r\n\t,acm.[PBR]\r\n\t,acm.[APPOINTMENT_TYPE]\r\n\t,acm.[FIRST_ATTENDANCE_CODE]\r\n\t,acm.[ATTENDED_OR_DID_NOT_ATTEND_CODE]\r\n\t,acm.[PRIMARY_PROCEDURE]\r\n\t,acm.[ALL_PROCEDURES]\r\n\t,acm.[APPOINTMENT_FILTER]\r\n\t,acm.[REPORT_GROUP]\r\n\t,acm.[PRIMARY_DIAGNOSIS]\r\n\t,acm.[ALL_DIAGNOSES]\r\n\t,acm.[CCP_TYPE]\r\n\t,acm.[CRITICAL_CARE_START_DATE_TIME]\r\n\t,acm.[CRITICAL_CARE_START_DATE_ID]\r\n\t,acm.[CRITICAL_CARE_DISCHARGE_DATE_TIME]\r\n\t,acm.[CRITICAL_CARE_DISCHARGE_DATE_ID]\r\n\t,acm.[CRITICAL_CARE_ACTIVITY_DATE]\r\n\t,acm.[CRITICAL_CARE_ACTIVITY_DATE_ID]\r\n\t,acm.[CRITICAL_CARE_UNIT_FUNCTION]\r\n\t,acm.[ALL_CRITICAL_CARE_ACTIVITY_CODES]\r\n\t,null [CRITICAL_CARE_LOCAL_ID]\r\n\t,acm.[OVERSEAS_VISITOR_STATUS]\r\n\t,acm.[STATUS]\r\n\t,acm.[ADMINISTRATIVE_CATEGORY_CODE]\r\n\t,acm.[DATA_QUALITY_FLAG]\r\n\t,acm.[LOCAL_FLAG]\r\n\t,acm.[PATHWAY_TYPE]\r\n\t,acm.[CONSULTANT_NAME]\r\n\t,acm.[CHANGE_LOG]\r\n\t,acm.[WARD_NAME_ADMISSION]\r\n\t,acm.[WARD_NAME_DISCHARGE]\r\n\t,acm.[CRITICAL_CARE_BED_DAYS]\r\n\t,acm.[REHAB_BED_DAYS]\r\n\t,acm.[EXCESS_BED_DAYS_ADJUSTED]\r\n\t,acm.[PRIVATE_PATIENT_FLAG]\r\n\t,acm.[CURRENT_PERMANENT_RESIDENCE_UK_FLAG]\r\n\t,acm.[OVERSEAS_VISITOR_CHARGEABLE_FLAG]\r\n\t,acm.[OVERSEAS_VISITOR_NONCHARGEABLE_FLAG]\r\n\t,acm.[PAYING_PATIENT_FLAG]\r\nFrom\r\n\tinp_ACM_PATIENT_LEVEL_OP acm With(nolock) \r\n\t--Inner Join DW2_Stage..stg_OPHRG_4_201415 hrg On acm.RECORD_ID = hrg.OUTPATIENT_APPOINTMENT_RECORD_ID\r\n\t--Inner Join DW2_Stage..[stg_OPUnbundled_HRG_4_201415] unb On hrg.RowNo = unb.RowNo\r\n\tInner Join CDS_63_OUTPATIENT_MAIN unb On acm.RECORD_ID = unb.RECORD_ID\r\n\r\n\r\n\r\n\r\n\r\n/*\r\n\r\nINSERT INTO INP_ACM_PATIENT_LEVEL_OP_UNB\r\n           (\r\n\t\t   [DATE_ENTERED]\r\n\t\t   ,[RECORD_ID]\r\n           ,[SYSTEM_ID]\r\n           ,[SITE]\r\n           ,[SPECIALTY_CODE_LOCAL]\r\n           ,[SPECIALTY_CODE_SUB]\r\n           ,[CONSULTANT_CODE]\r\n           ,[HA_CODE]\r\n           ,[COMMISSIONER_CODE]\r\n           ,[CONTRACT_CODE]\r\n           ,[POD_CODE_LOCAL]\r\n           ,[REGISTERED_PRACTICE_CODE]\r\n           ,[HRG_CODE]\r\n           ,[ACTIVITY_DATE_TIME]\r\n           ,[ACTIVITY_DATE_ID]\r\n           ,[ACTIVITY_DATE]\r\n           ,[ACTIVITY_VOLUME]\r\n           ,[SLID_CODE]\r\n           ,[TARGET_CODE]\r\n           ,[SPECSERVICE_ID]\r\n           ,[SPECSERVICE_ID_2]\r\n           ,[SPECSERVICE_ID_3]\r\n           ,[SPECSERVICE_ID_4]\r\n           ,[SPECSERVICE_ID_5]\r\n           ,[SPECSERVICE_ID_6]\r\n           ,[SPECSERVICE_ID_7]\r\n           ,[SPECSERVICE_ID_8]\r\n           ,[SPECSERVICE_ID_9]\r\n           ,[SPECSERVICE_ID_10]\r\n           ,[SPECSERVICE_ID_11]\r\n           ,[SPECSERVICE_ID_12]\r\n           ,[SPECSERVICE_ID_13]\r\n           ,[SPECSERVICE_ID_14]\r\n           --,[LOS]\r\n           ,[REPORT_MASTER_ID]\r\n           ,[USER_DEFINED_ACTIVITY_CODE_01]\r\n           ,[USER_DEFINED_ACTIVITY_CODE_02]\r\n           ,[USER_DEFINED_ACTIVITY_CODE_03]\r\n           ,[NPOC]\r\n           ,[ACTIVITY_TREATMENT_FUNCTION_CODE]\r\n\t\t   ,[ADMISSION_DATE_TIME]\r\n\t\t   ,[ADMISSION_DATE]\r\n\t\t   ,[ADMISSION_DATE_ID]\r\n\t\t   ,[DISCHARGE_DATE_TIME]\r\n\t\t   ,[DISCHARGE_DATE]\r\n\t\t   ,[DISCHARGE_DATE_ID]\r\n           ,[PATIENT_CLASS_CODE]\r\n           ,[ADMISSION_METHOD_CODE]\r\n           ,[WEIGHT]\r\n           ,[IS_READMISSION]\r\n           ,[SERVICE_LINE_CODE]\r\n           ,[ORIGINATING_CCG_CODE]\r\n           ,[NHS_NUMBER]\r\n           ,[PATIENT_POSTCODE]\r\n           ,[CLINIC_CODE]\r\n           --,[WARD_CODE]\r\n           ,[ICD10_CODE]\r\n           ,[OPCS_CODE]\r\n           ,[USER_DEFINED_ACTUAL_ACTIVITY_CODE_01]\r\n           ,[USER_DEFINED_ACTUAL_ACTIVITY_CODE_02]\r\n           ,[USER_DEFINED_ACTUAL_ACTIVITY_CODE_03]\r\n           ,[USER_DEFINED_ACTUAL_ACTIVITY_CODE_04]\r\n           ,[USER_DEFINED_ACTUAL_ACTIVITY_CODE_05]\r\n           ,[PSEUDONYMISED_REPORT_MASTER_ID]\r\n           ,[REFERRAL_SOURCE_CODE]\r\n           ,[PATHWAY_ID]\r\n           ,[SPECIALTY_CODE_MAIN]\r\n           ,[SUS_ACTIVITY_ID]\r\n           ,[SERVICE_CLASS_CODE]\r\n\t\t   ,[ACTIVITY_IDENTIFIER]\r\n\t\t   ,[POD_CODE_NHSE]\r\n\t\t   ,[MOD_FLAG]\r\n\t\t   ,[MOD_FLAG_LOCAL]\r\n\t\t   ,[JUSTICE_FLAG]\r\n\t\t   ,[JUSTICE_FLAG_LOCAL]\r\n\t\t   ,[SPECIALIST_FLAG]\r\n\t\t   ,[SPECIALIST_FLAG_LOCAL]\r\n\t\t   ,[PBR]\r\n\t\t   ,[APPOINTMENT_TYPE]\r\n\t\t   ,[FIRST_ATTENDANCE_CODE]\r\n\t\t   ,[ATTENDED_OR_DID_NOT_ATTEND_CODE]\r\n\t\t   ,[PRIMARY_PROCEDURE]\r\n\t\t   ,[ALL_PROCEDURES]\r\n\t\t   )\r\nSelect\r\n\t\t\tGetdate() [DATE_ENTERED]\r\n\t\t\t,a.[RECORD_ID]\r\n           ,a.[SYSTEM_ID]\r\n           ,l07.SITE_CODE_OF_TREATMENT [SITE] --Check This\r\n           ,Null [CONTRACT_SPECIALTY] --\r\n           ,Null [SUB_SPECIALTY]\r\n           ,a.CONSULTANT_CODE_CDS [CONSULTANT_CODE]\r\n           ,Null [HA_CODE]\r\n           ,l06.[ORGANISATION_CODE_CODE_OF_COMMISSIONER] [COMMISSIONER_CODE]\r\n           ,Null [CONTRACT_CODE]\r\n           ,Null [POD_CODE]\r\n           ,a.GENERAL_MEDICAL_PRACTICE_CODE_PATIENT_REGISTRATION [REGISTERED_PRACTICE_CODE]\r\n           --,hrg.NAC_HRG [HRG_CODE]\r\n\t\t   ,unb.UnbundledHRGs [HRG_CODE]\r\n           ,a.ACTIVITY_DATE [ACTIVITY_DATE_TIME]\r\n           ,Convert(Varchar(8),a.ACTIVITY_DATE,112) [ACTIVITY_DATE_ID]\r\n           ,Convert(Varchar(8),a.ACTIVITY_DATE,112) [ACTIVITY_DATE]\r\n           ,1 [ACTIVITY_VOLUME]\r\n           ,pss.ServiceLine [SLID_CODE]\r\n           ,Null [TARGET_CODE]\r\n           ,Null [SPECSERVICE_ID]\r\n           ,Null [SPECSERVICE_ID_2]\r\n           ,Null [SPECSERVICE_ID_3]\r\n           ,Null [SPECSERVICE_ID_4]\r\n           ,Null [SPECSERVICE_ID_5]\r\n           ,Null [SPECSERVICE_ID_6]\r\n           ,Null [SPECSERVICE_ID_7]\r\n           ,Null [SPECSERVICE_ID_8]\r\n           ,Null [SPECSERVICE_ID_9]\r\n           ,Null [SPECSERVICE_ID_10]\r\n           ,Null [SPECSERVICE_ID_11]\r\n           ,Null [SPECSERVICE_ID_12]\r\n           ,Null [SPECSERVICE_ID_13]\r\n           ,Null [SPECSERVICE_ID_14]\r\n           --,Null [LOS]\r\n           ,Null [REPORT_MASTER_ID]\r\n           ,Null [USER_DEFINED_ACTIVITY_CODE_01]\r\n           ,Null [USER_DEFINED_ACTIVITY_CODE_02]\r\n           ,Null [USER_DEFINED_ACTIVITY_CODE_03]\r\n           ,pss.NPOC [NPOC]\r\n           ,a.TREATMENT_FUNCTION_CODE [ACTIVITY_TREATMENT_FUNCTION_CODE]\r\n\t\t   ,a.ACTIVITY_DATE [ADMISSION_DATE_TIME]\r\n\t\t   ,Convert(Varchar(8),a.ACTIVITY_DATE,112) [ADMISSION_DATE]\r\n\t\t   ,Convert(Varchar(8),a.ACTIVITY_DATE,112) [ADMISSION_DATE_ID]\r\n\t\t   ,a.ACTIVITY_DATE [DISCHARGE_DATE_TIME]\r\n\t\t   ,Convert(Varchar(8),a.ACTIVITY_DATE,112) [DISCHARGE_DATE]\r\n\t\t   ,Convert(Varchar(8),a.ACTIVITY_DATE,112) [DISCHARGE_DATE_ID]\r\n           ,Null [PATIENT_CLASS_CODE]\r\n           ,Null [ADMISSION_METHOD_CODE]\r\n           ,Null [WEIGHT]\r\n           ,Null [IS_READMISSION]\r\n           ,Null [SERVICE_LINE_CODE]\r\n           ,Null [ORIGINATING_CCG_CODE]\r\n           ,p.NHS_NUMBER [NHS_NUMBER]\r\n           ,a.POST_CODE_AT_ATTENDANCE_DATE [PATIENT_POSTCODE]\r\n           ,Null [CLINIC_CODE]\r\n           --,Null [WARD_CODE]\r\n           ,Null [ICD10_CODE]\r\n           ,Null [OPCS_CODE]\r\n           ,Null [USER_DEFINED_ACTUAL_ACTIVITY_CODE_01]\r\n           ,Null [USER_DEFINED_ACTUAL_ACTIVITY_CODE_02]\r\n           ,Null [USER_DEFINED_ACTUAL_ACTIVITY_CODE_03]\r\n           ,Null [USER_DEFINED_ACTUAL_ACTIVITY_CODE_04]\r\n           ,Null [USER_DEFINED_ACTUAL_ACTIVITY_CODE_05]\r\n           ,Null [PSEUDONYMISED_REPORT_MASTER_ID]\r\n           ,l05.SOURCE_OF_REFERRAL_FOR_OUT_PATIENTS [REFERRAL_SOURCE_CODE]\r\n           ,l01.PATIENT_PATHWAY_IDENTIFIER [PATHWAY_ID]\r\n           ,a.MAIN_SPECIALTY_CODE [MAIN_SPECIALTY_CODE]\r\n           ,l00.CDS_UNIQUE_ID [SUS_ACTIVITY_ID]\r\n           ,Null [SERVICE_CLASS_CODE]\r\n\t\t   ,a.SOURCE_ID\r\n\t\t   ,Null [NHSE_POD_CODE]\t\t   \r\n\t\t   ,[MOD_FLAG]\r\n\t\t   ,Null [MOD_FLAG_LOCAL]\r\n\t\t   ,[JUSTICE_FLAG]\r\n\t\t   ,Null [JUSTICE_FLAG_LOCAL]\r\n\t\t   ,a.SPECIALIST_COMMISSIONING_FLAG [SPECIALIST_FLAG]\r\n\t\t   ,Null [SPECIALIST_FLAG_LOCAL]\r\n\t\t   ,1 [PBR]\r\n\t\t   ,a.APPOINTMENT_TYPE [APPOINTMENT_TYPE]\r\n\t\t   ,A.FIRST_ATTENDANCE_CODE [FIRST_ATTENDANCE_CODE]\r\n\t\t   ,l05.ATTENDED_OR_DID_NOT_ATTEND_CODE [ATTENDED_OR_DID_NOT_ATTEND_CODE]\r\n\t\t   ,pr.PROCEDURE_01 [PRIMARY_PROCEDURE]\r\n\t\t   ,Isnull(pr.PROCEDURE_01,'') + '|' + Isnull(pr.PROCEDURE_02,'') + '|' + Isnull(pr.PROCEDURE_03,'') + '|' + Isnull(pr.PROCEDURE_04,'') + '|' + Isnull(pr.PROCEDURE_05,'') + '|'\r\n\t\t    + Isnull(pr.PROCEDURE_06,'') + '|' + Isnull(pr.PROCEDURE_07,'') + '|' + Isnull(pr.PROCEDURE_08,'') + '|' + Isnull(pr.PROCEDURE_09,'') + '|' + Isnull(pr.PROCEDURE_10,'') + '|'\r\n\t\t\t+ Isnull(pr.PROCEDURE_11,'') + '|' + Isnull(pr.PROCEDURE_12,'') + '|' + Isnull(pr.PROCEDURE_13,'') + '|' + Isnull(pr.PROCEDURE_14,'') + '|' + Isnull(pr.PROCEDURE_15,'') + '|'\r\n\t\t\t+ Isnull(pr.PROCEDURE_16,'') + '|' + Isnull(pr.PROCEDURE_17,'') + '|' + Isnull(pr.PROCEDURE_18,'') + '|' + Isnull(pr.PROCEDURE_19,'') + '|' + Isnull(pr.PROCEDURE_20,'') + '|' [ALL_PROCEDURES]\r\nFrom\r\n\tBedrock.outp.OUTPATIENT_APPOINTMENT a\r\n\tLeft Join Bedrock.outp.OUTPATIENT_APPOINTMENT_PROCEDURE_SR pr On a.RECORD_ID = pr.OUTPATIENT_APPOINTMENT_RECORD_ID\r\n\tInner Join Bedrock.outp.PATIENT p On a.PATIENT_RECORD_ID = p.RECORD_ID\r\n\tInner Join DW2_Stage..stg_OPHRG_4_201415 hrg On a.RECORD_ID = hrg.OUTPATIENT_APPOINTMENT_RECORD_ID\r\n\tInner Join DW2_Stage..[stg_OPUnbundled_HRG_4_201415] unb On hrg.RowNo = unb.RowNo\r\n\tLeft Join DW2_Stage..stg_OPPSS_201415 pss On a.RECORD_ID = pss.OUTPATIENT_APPOINTMENT_RECORD_ID\r\n\tInner Join Bedrock.outp.CDS_020_OPS_62_00_TRANSACTION_HEADER l00 On a.RECORD_ID = l00.RECORD_JOIN_ID\r\n\tLeft Join Bedrock.outp.CDS_020_OPS_62_01_PATIENT_PATHWAY l01 On a.RECORD_ID = l01.RECORD_ID\r\n\tInner Join Bedrock.outp.CDS_020_OPS_62_02_PATIENT_IDENTITY l02 On a.RECORD_ID = l02.RECORD_ID\r\n\tInner Join Bedrock.outp.CDS_020_OPS_62_05_ACTIVITY_CHARACTERISTICS l05 On a.RECORD_ID = l05.RECORD_ID\r\n\tInner Join Bedrock.outp.CDS_020_OPS_62_06_ATTENDANCE_OCCURENCE_SERVICE_AGREEMENT l06 On a.RECORD_ID = l06.RECORD_ID\r\n\tInner Join Bedrock.outp.CDS_020_OPS_62_07_LOCATION_GROUP_ATTENDANCE l07 On a.RECORD_ID = l07.RECORD_JOIN_ID\r\nWhere\r\n\ta.ACTIVITY_DATE >= '20150401'\r\n\tAnd a.ACTIVITY_DATE < '20160301'\r\n\r\n--Remove Extra Pipes\r\nUpdate a\r\nSet\r\n\t[ALL_PROCEDURES] = Left([ALL_PROCEDURES],Charindex('||',[ALL_PROCEDURES])-1)\r\n--Select\r\n--\tLeft([ALL_PROCEDURES],Charindex('||',[ALL_PROCEDURES])-1)\r\n--\t,ALL_PROCEDURES\r\nFrom\r\n\tACM_PATIENT_LEVEL_OP_UNB a\r\n\r\nUpdate a\r\nSet\r\n\t[ALL_PROCEDURES] = NullIf([ALL_PROCEDURES],'')\r\n--Select\r\n--\tLeft([ALL_PROCEDURES],Charindex('||',[ALL_PROCEDURES])-1)\r\n--\t,ALL_PROCEDURES\r\nFrom\r\n\tACM_PATIENT_LEVEL_OP_UNB a\r\n\r\n--Contract Code\r\n--update sd\r\n--set \r\n--\tCONTRACT_CODE = c.CCG_CODE\r\n--from \r\n--\t--inp.a_and_E_attendance a \r\n--\tINP_ACM_PATIENT_LEVEL_OP_UNB sd\r\n--\tInner Join Bedrock.outp.OUTPATIENT_APPOINTMENT a on sd.RECORD_ID = a.RECORD_ID\r\n--\tinner join [RBHDWHRED001].Local_Reference_DB.ref.local_contract c on ae.ORGANISATION_CODE_CODE_OF_COMMISSIONER = c.CCG_CODE\r\n--\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAnd sd.ACTIVITY_DATE Between c.EFFECTIVE_START And c.EFFECTIVE_END\r\n\r\n--Contract Code\r\nupdate sd\r\nset \r\n\tCONTRACT_CODE = Isnull(c.CCG_CODE,'9XX')\r\nfrom \r\n\t--inp.a_and_E_attendance a \r\n\tINP_ACM_PATIENT_LEVEL_OP_UNB sd\r\n\tInner Join Bedrock.outp.OUTPATIENT_APPOINTMENT a on sd.RECORD_ID = a.RECORD_ID\r\n\tInner Join Bedrock.outp.CDS_020_OPS_62_06_ATTENDANCE_OCCURENCE_SERVICE_AGREEMENT l06 On a.RECORD_ID = l06.RECORD_JOIN_ID\r\n\tLeft join [RBHDWHRED001].Local_Reference_DB.ref.local_contract c on Left(l06.ORGANISATION_CODE_CODE_OF_COMMISSIONER,3) = Left(c.CCG_CODE,3)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAnd sd.ACTIVITY_DATE Between c.EFFECTIVE_START And c.EFFECTIVE_END\r\n\r\n--Select * From ReferenceDB..Postcode\r\n--HA Code\r\nupdate sd\r\nset \r\n\tHA_CODE = p.Strategic_Health_Authority\r\n--\t,ORIGINATING_CCG_CODE = Isnull(c.High_Level_Health_Authority_Code,p.Strategic_Health_Authority)\r\nfrom \r\n\t--inp.a_and_E_attendance a \r\n\tINP_ACM_PATIENT_LEVEL_OP_UNB sd\r\n\tInner Join Bedrock.outp.OUTPATIENT_APPOINTMENT a on sd.RECORD_ID = a.RECORD_ID\r\n\tLeft Join ReferenceDB..Postcode p On REPLACE(a.POST_CODE_AT_ATTENDANCE_DATE,' ','') = p.POSTCODE_NO_SPACE\r\n\t\t\t\t\t\t\t\t\t\tAnd a.ACTIVITY_DATE >= p.Effective_From\r\n\t\t\t\t\t\t\t\t\t\tAnd a.ACTIVITY_DATE < Isnull(p.Effective_To,'20990101')\r\n\t--Left Join ReferenceDB.dbo.Commissioner c On ae.ORGANISATION_CODE_RESIDENCE_RESPONSIBILITY = c.Commissioner_Org_Code\r\n\t--Inner Join ReferenceDB.dbo.Commissioner c On ae.ORGANISATION_CODE_CODE_OF_COMMISSIONER = c.Commissioner_Org_Code\r\n\r\n--Originating CCG Code\r\nupdate sd\r\nset \r\n\tORIGINATING_CCG_CODE = Isnull(c.High_Level_Health_Authority_Code,c.Commissioner_Org_Code)\r\n--Select c.*\r\nfrom \r\n\t--inp.a_and_E_attendance a \r\n\tINP_ACM_PATIENT_LEVEL_OP_UNB sd\r\n\tInner Join Bedrock.outp.OUTPATIENT_APPOINTMENT ae on sd.RECORD_ID = ae.RECORD_ID\r\n\tInner Join Bedrock.outp.CDS_020_OPS_62_06_ATTENDANCE_OCCURENCE_SERVICE_AGREEMENT l06 On ae.RECORD_ID = l06.RECORD_JOIN_ID\r\n\tLeft Join ReferenceDB.dbo.Commissioner c On Left(l06.ORGANISATION_CODE_CODE_OF_COMMISSIONER,3) = Left(c.Commissioner_Org_Code,3)\r\n\r\nupdate sd\r\nset \r\n\tORIGINATING_CCG_CODE = Left(l06.ORGANISATION_CODE_CODE_OF_COMMISSIONER,3)\r\n--Select c.*\r\nfrom \r\n\t--inp.a_and_E_attendance a \r\n\tINP_ACM_PATIENT_LEVEL_OP_UNB sd\r\n\tInner Join Bedrock.outp.OUTPATIENT_APPOINTMENT ae on sd.RECORD_ID = ae.RECORD_ID\r\n\tInner Join Bedrock.outp.CDS_020_OPS_62_06_ATTENDANCE_OCCURENCE_SERVICE_AGREEMENT l06 On ae.RECORD_ID = l06.RECORD_JOIN_ID\r\n\tLeft Join ReferenceDB.dbo.Commissioner c On Left(l06.ORGANISATION_CODE_CODE_OF_COMMISSIONER,3) = Left(c.Commissioner_Org_Code,3)\r\nWhere\r\n\tORIGINATING_CCG_CODE Is null\r\n\tAnd Left(l06.ORGANISATION_CODE_CODE_OF_COMMISSIONER,3) Like 'Q%'\r\n\r\n--Errors\r\nupdate sd\r\nset \r\n\tORIGINATING_CCG_CODE = '!!'\r\n--Select c.*\r\nfrom \r\n\t--inp.a_and_E_attendance a \r\n\tINP_ACM_PATIENT_LEVEL_OP_UNB sd\r\n\tInner Join Bedrock.outp.OUTPATIENT_APPOINTMENT ae on sd.RECORD_ID = ae.RECORD_ID\r\n\tInner Join Bedrock.outp.CDS_020_OPS_62_06_ATTENDANCE_OCCURENCE_SERVICE_AGREEMENT l06 On ae.RECORD_ID = l06.RECORD_JOIN_ID\r\n\tLeft Join ReferenceDB.dbo.Commissioner c On Left(l06.ORGANISATION_CODE_CODE_OF_COMMISSIONER,3) = Left(c.Commissioner_Org_Code,3)\r\nWhere\r\n\tORIGINATING_CCG_CODE Is null\r\n\r\n\r\n--Service Class Code\r\n--Errors\r\nupdate sd\r\nset \r\n\tSERVICE_CLASS_CODE = Case When MOD_FLAG = 1 Then 'AF'\r\n\t\t\t\t\t\t\t\tWhen JUSTICE_FLAG = 1 Then 'HJ'\r\n\t\t\t\t\t\t\t\tWhen SPECIALIST_FLAG = 1 Then 'SS'\r\n\t\t\t\t\t\t\tElse\r\n\t\t\t\t\t\t\t\t'99'\r\n\t\t\t\t\t\t\tEnd\r\n--Select c.*\r\nfrom \r\n\t--inp.a_and_E_attendance a \r\n\tINP_ACM_PATIENT_LEVEL_OP_UNB sd\r\n\r\n\r\n--Where sd.RECORD_ID = 5000000274527\r\n\r\n--select * From ReferenceDB.dbo.Commissioner where Commissioner_Org_Code like 'q%'\r\n\r\n--select * From Bedrock.outp.CDS_020_OPS_62_06_ATTENDANCE_OCCURENCE_SERVICE_AGREEMENT\r\n\r\n--Select * From ReferenceDB..GP_GDP_PRACTICE\r\n--Select * From ReferenceDB..GPPractice where Organisation_Code = 's63438'\r\n\r\n\r\n\r\n--Select * From ReferenceDB..Commissioner\r\n\r\n--ACTIVITY_TYPE\r\n--update sd\r\n--set \r\n--\tACTIVITY_TYPE = 'AandE'\r\n--from \r\n--\t--inp.a_and_E_attendance a \r\n--\tINP_ACM_PATIENT_LEVEL_OP_UNB sd\r\n\r\n/*\r\n--Contract Specialty\r\nupdate sd\r\nset SPECIALTY_CODE_LOCAL = CASE WHEN A_AND_E_DEPARTMENT_TYPE = '01' THEN 'AE' ELSE 'CA130' END\r\nfrom \r\n\t--inp.a_and_E_attendance a \r\n\tINP_ACM_PATIENT_LEVEL_OP_UNB sd\r\n\tInner Join Bedrock.outp.OUTPATIENT_APPOINTMENT ae on sd.RECORD_ID = ae.RECORD_ID\r\n*/\r\n--POD Code\r\nupdate sd\r\nset \r\n\tPOD_CODE_LOCAL = Case \r\n\t\t\t\t\t\tWhen HRG_CODE = 'WF01A' Then 'OPFUPSPCL'\r\n\t\t\t\t\t\tWhen HRG_CODE = 'WF01B' Then 'OPFASPCL'\r\n\t\t\t\t\t\tWhen HRG_CODE = 'WF01C' Then 'NFTF'\r\n\t\t\t\t\t\tWhen HRG_CODE = 'WF01D' Then 'NFTF'\r\n\t\t\t\t\t\tWhen HRG_CODE = 'WF02A' Then 'OPFUPMPCL'\r\n\t\t\t\t\t\tWhen HRG_CODE = 'WF02B' Then 'OPFAMPCL'\r\n\t\t\t\t\t\tWhen HRG_CODE = 'WF02C' Then 'NFTF'\r\n\t\t\t\t\t\tWhen HRG_CODE = 'WF02D' Then 'NFTF'\r\n\t\t\t\t\tElse\r\n\t\t\t\t\t\t'Other'\r\n\t\t\t\t\tEnd\r\n\t\t\t\t\t\t\r\n\t,POD_CODE_NHSE = Case \r\n\t\t\t\t\t\tWhen HRG_CODE = 'WF01A' Then 'OPFUPSPCL'\r\n\t\t\t\t\t\tWhen HRG_CODE = 'WF01B' Then 'OPFASPCL'\r\n\t\t\t\t\t\tWhen HRG_CODE = 'WF01C' Then 'NFTF'\r\n\t\t\t\t\t\tWhen HRG_CODE = 'WF01D' Then 'NFTF'\r\n\t\t\t\t\t\tWhen HRG_CODE = 'WF02A' Then 'OPFUPMPCL'\r\n\t\t\t\t\t\tWhen HRG_CODE = 'WF02B' Then 'OPFAMPCL'\r\n\t\t\t\t\t\tWhen HRG_CODE = 'WF02C' Then 'NFTF'\r\n\t\t\t\t\t\tWhen HRG_CODE = 'WF02D' Then 'NFTF'\r\n\t\t\t\t\tElse\r\n\t\t\t\t\t\t'Other'\r\n\t\t\t\t\tEnd\r\nfrom \r\n\t--inp.a_and_E_attendance a \r\n\tINP_ACM_PATIENT_LEVEL_OP_UNB sd\r\n\r\n\r\n\r\n\r\n\r\n\r\n \r\n \r\nSelect Top 1000 * From ACM_PATIENT_LEVEL_OP_UNB-- where ORIGINATING_CCG_CODE is null\r\n--Select * From ReferenceDB..Postcode where POSTCODE_NO_SPACE in(Select PATIENT_POSTCODE From SLAM_detail where HA_CODE is null)\r\n\r\n--Select * From [RBHDWHRED001].Local_Reference_DB.ref.local_contract\r\n/*\r\nSelect\t\r\n\t* \r\nFrom \r\n\tBedrock.INFORMATION_SCHEMA.COLUMNS\r\nWhere \r\n\t(TABLE_NAME Like '%020%'\r\n\tOr TABLE_NAME Like 'outpatient_appointment')\r\n\tAnd COLUMN_NAME Like '%pathway%'\r\n*/\r\n\r\n--Needed From Cerner\r\n--Primary and Secondary Procedures\r\n\r\n--Select * From bedrock.outp.OUTPATIENT_APPOINTMENT_PROCEDURE_SR\r\n*/"}
{"SQLID":400000414,"OperationSQL":"/* Operation Name :  Load To Input \n Add Rule Description here.*/\n \r\n--Alter Table SLAM_DETAIL\r\n--Add ACTIVITY_IDENTIFIER Varchar(20)\r\n--,NHSE_POD_CODE Varchar(20)\r\n\r\n--Alter Table SLAM_DETAIL\r\n--Add ACTIVITY_IDENTIFIER Varchar(20)\r\n--,NHSE_POD_CODE Varchar(20)\r\nTruncate Table INP_ACM_PATIENT_LEVEL_OP_UNB\r\nGo\r\nInsert Into INP_ACM_PATIENT_LEVEL_OP_UNB\r\n(\r\n\t[ROW_ID]\r\n\t,[DATE_ENTERED]\r\n\t,[RECORD_ID]\r\n\t,[SYSTEM_ID]\r\n\t,[SUS_ACTIVITY_ID]\r\n\t,[ACTIVITY_IDENTIFIER]\r\n\t,[ENCNTR_ID]\r\n\t,[EPISODE_NUMBER]\r\n\t,[SITE]\r\n\t,[SPECIALTY_CODE_MAIN]\r\n\t,[SPECIALTY_CODE_LOCAL]\r\n\t,[SPECIALTY_CODE_SUB]\r\n\t,[ACTIVITY_TREATMENT_FUNCTION_CODE]\r\n\t,[ACTIVITY_TREATMENT_FUNCTION_CODE_LOCAL]\r\n\t,[CONSULTANT_CODE]\r\n\t,[HA_CODE]\r\n\t,[ORIGINATING_CCG_CODE]\r\n\t,[COMMISSIONER_CODE]\r\n\t,[COMMISSIONER_CODE_LOCAL]\r\n\t,[COMMISSIONER_CODE_ORIGINAL]\r\n\t,[REGISTERED_PRACTICE_CODE]\r\n\t,[CONTRACT_CODE]\r\n\t,[POD_CODE_LOCAL]\r\n\t,[POD_CODE_NHSE]\r\n\t,[HRG_CODE]\r\n\t,[HRG_CODE_LOCAL]\r\n\t,[UNBUNDLED_HRG_CODE]\r\n\t,[ATTENDANCE_HRG]\r\n\t,[SPELL_REPORT_FLAG]\r\n\t,[ACTIVITY_DATE_TIME]\r\n\t,[ACTIVITY_DATE_ID]\r\n\t,[ACTIVITY_DATE]\r\n\t,[ACTIVITY_VOLUME]\r\n\t,[SLID_CODE]\r\n\t,[SLID_CODE_LOCAL]\r\n\t,[NPOC]\r\n\t,[NPOC_LOCAL]\r\n\t,[TARGET_CODE]\r\n\t,[SPECSERVICE_ID]\r\n\t,[SPECSERVICE_ID_2]\r\n\t,[SPECSERVICE_ID_3]\r\n\t,[SPECSERVICE_ID_4]\r\n\t,[SPECSERVICE_ID_5]\r\n\t,[SPECSERVICE_ID_6]\r\n\t,[SPECSERVICE_ID_7]\r\n\t,[SPECSERVICE_ID_8]\r\n\t,[SPECSERVICE_ID_9]\r\n\t,[SPECSERVICE_ID_10]\r\n\t,[SPECSERVICE_ID_11]\r\n\t,[SPECSERVICE_ID_12]\r\n\t,[SPECSERVICE_ID_13]\r\n\t,[SPECSERVICE_ID_14]\r\n\t,[SPECSERVICE_ID_15]\r\n\t,[SPECSERVICE_ID_16]\r\n\t,[SPECSERVICE_ID_17]\r\n\t,[SPECSERVICE_ID_18]\r\n\t,[SPECSERVICE_ID_19]\r\n\t,[SPECSERVICE_ID_20]\r\n\t,[SPECSERVICE_ID_21]\r\n\t,[LENGTH_OF_SPELL]\r\n\t,[LENGTH_OF_EPISODE]\r\n\t,[TRIMPOINT_EL]\r\n\t,[TRIMPOINT_NEL]\r\n\t,[EXCESS_BED_DAYS_EL]\r\n\t,[EXCESS_BED_DAYS_NEL]\r\n\t,[EXCESS_BED_DAYS]\r\n\t,[REPORT_MASTER_ID]\r\n\t,[USER_DEFINED_ACTIVITY_CODE_01]\r\n\t,[USER_DEFINED_ACTIVITY_CODE_02]\r\n\t,[USER_DEFINED_ACTIVITY_CODE_03]\r\n\t,[ADMISSION_DATE_TIME]\r\n\t,[ADMISSION_DATE]\r\n\t,[ADMISSION_DATE_ID]\r\n\t,[DISCHARGE_DATE_TIME]\r\n\t,[DISCHARGE_DATE]\r\n\t,[DISCHARGE_DATE_ID]\r\n\t,[EPISODE_START_DATE_TIME]\r\n\t,[EPISODE_START_DATE]\r\n\t,[EPISODE_START_DATE_ID]\r\n\t,[EPISODE_END_DATE_TIME]\r\n\t,[EPISODE_END_DATE]\r\n\t,[EPISODE_END_DATE_ID]\r\n\t,[PATIENT_CLASS_CODE]\r\n\t,[ADMISSION_METHOD_CODE]\r\n\t,[INTENDED_MANAGEMENT_CODE]\r\n\t,[FIRST_REGULAR_DAY_OR_NIGHT_ADMISSION]\r\n\t,[WEIGHT]\r\n\t,[IS_READMISSION]\r\n\t,[READMISSION_DAYS]\r\n\t,[SERVICE_LINE_CODE]\r\n\t,[PERSON_ID]\r\n\t,[HOSPITAL_NUMBER]\r\n\t,[NHS_NUMBER]\r\n\t,[AGE_AT_ACTIVITY_DATE]\r\n\t,[DATE_OF_BIRTH]\r\n\t,[PATIENT_GENDER]\r\n\t,[PATIENT_POSTCODE]\r\n\t,[CLINIC_CODE]\r\n\t,[WARD_CODE_ADMISSION]\r\n\t,[WARD_CODE_DISCHARGE]\r\n\t,[ICD10_CODE]\r\n\t,[OPCS_CODE]\r\n\t,[USER_DEFINED_ACTUAL_ACTIVITY_CODE_01]\r\n\t,[USER_DEFINED_ACTUAL_ACTIVITY_CODE_02]\r\n\t,[USER_DEFINED_ACTUAL_ACTIVITY_CODE_03]\r\n\t,[USER_DEFINED_ACTUAL_ACTIVITY_CODE_04]\r\n\t,[USER_DEFINED_ACTUAL_ACTIVITY_CODE_05]\r\n\t,[PSEUDONYMISED_REPORT_MASTER_ID]\r\n\t,[REFERRAL_SOURCE_CODE]\r\n\t,[PATHWAY_ID]\r\n\t,[SERVICE_CLASS_CODE]\r\n\t,[MOD_FLAG]\r\n\t,[MOD_FLAG_LOCAL]\r\n\t,[JUSTICE_FLAG]\r\n\t,[JUSTICE_FLAG_LOCAL]\r\n\t,[SPECIALIST_FLAG]\r\n\t,[SPECIALIST_FLAG_LOCAL]\r\n\t,[PBR]\r\n\t,[APPOINTMENT_TYPE]\r\n\t,[FIRST_ATTENDANCE_CODE]\r\n\t,[ATTENDED_OR_DID_NOT_ATTEND_CODE]\r\n\t,[PRIMARY_PROCEDURE]\r\n\t,[ALL_PROCEDURES]\r\n\t,[APPOINTMENT_FILTER]\r\n\t,[REPORT_GROUP]\r\n\t,[PRIMARY_DIAGNOSIS]\r\n\t,[ALL_DIAGNOSES]\r\n\t,[CCP_TYPE]\r\n\t,[CRITICAL_CARE_START_DATE_TIME]\r\n\t,[CRITICAL_CARE_START_DATE_ID]\r\n\t,[CRITICAL_CARE_DISCHARGE_DATE_TIME]\r\n\t,[CRITICAL_CARE_DISCHARGE_DATE_ID]\r\n\t,[CRITICAL_CARE_ACTIVITY_DATE]\r\n\t,[CRITICAL_CARE_ACTIVITY_DATE_ID]\r\n\t,[CRITICAL_CARE_UNIT_FUNCTION]\r\n\t,[ALL_CRITICAL_CARE_ACTIVITY_CODES]\r\n\t,[CRITICAL_CARE_LOCAL_ID]\r\n\t,[OVERSEAS_VISITOR_STATUS]\r\n\t,[STATUS]\r\n\t,[ADMINISTRATIVE_CATEGORY_CODE]\r\n\t,[DATA_QUALITY_FLAG]\r\n\t,[LOCAL_FLAG]\r\n\t,[PATHWAY_TYPE]\r\n\t,[CONSULTANT_NAME]\r\n\t,[CHANGE_LOG]\r\n\t,[WARD_NAME_ADMISSION]\r\n\t,[WARD_NAME_DISCHARGE]\r\n\t,[CRITICAL_CARE_BED_DAYS]\r\n\t,[REHAB_BED_DAYS]\r\n\t,[EXCESS_BED_DAYS_ADJUSTED]\r\n\t,[PRIVATE_PATIENT_FLAG]\r\n\t,[CURRENT_PERMANENT_RESIDENCE_UK_FLAG]\r\n\t,[OVERSEAS_VISITOR_CHARGEABLE_FLAG]\r\n\t,[OVERSEAS_VISITOR_NONCHARGEABLE_FLAG]\r\n\t,[PAYING_PATIENT_FLAG]\r\n)\r\nSELECT \r\n\tacm.[ROW_ID]\r\n\t,acm.[DATE_ENTERED]\r\n\t,acm.[RECORD_ID]\r\n\t,acm.[SYSTEM_ID]\r\n\t,acm.[SUS_ACTIVITY_ID]\r\n\t,acm.[ACTIVITY_IDENTIFIER]\r\n\t,acm.[ENCNTR_ID]\r\n\t,acm.[EPISODE_NUMBER]\r\n\t,acm.[SITE]\r\n\t,acm.[SPECIALTY_CODE_MAIN]\r\n\t,acm.[SPECIALTY_CODE_LOCAL]\r\n\t,acm.[SPECIALTY_CODE_SUB]\r\n\t,acm.[ACTIVITY_TREATMENT_FUNCTION_CODE]\r\n\t,acm.[ACTIVITY_TREATMENT_FUNCTION_CODE_LOCAL]\r\n\t,acm.[CONSULTANT_CODE]\r\n\t,acm.[HA_CODE]\r\n\t,acm.[ORIGINATING_CCG_CODE]\r\n\t,acm.[COMMISSIONER_CODE]\r\n\t,acm.[COMMISSIONER_CODE_LOCAL]\r\n\t,acm.[COMMISSIONER_CODE_ORIGINAL]\r\n\t,acm.[REGISTERED_PRACTICE_CODE]\r\n\t,acm.[CONTRACT_CODE]\r\n\t,acm.[POD_CODE_LOCAL]\r\n\t,acm.[POD_CODE_NHSE]\r\n\t,acm.[HRG_CODE]\r\n\t,acm.[HRG_CODE_LOCAL]\r\n\t,convert(varchar(255),null) [UNBUNDLED_HRG_CODE]  --unb.UnbundledHRGs\r\n\t,acm.[ATTENDANCE_HRG]\r\n\t,acm.[SPELL_REPORT_FLAG]\r\n\t,acm.[ACTIVITY_DATE_TIME]\r\n\t,acm.[ACTIVITY_DATE_ID]\r\n\t,acm.[ACTIVITY_DATE]\r\n\t,acm.[ACTIVITY_VOLUME]\r\n\t,acm.[SLID_CODE]\r\n\t,acm.[SLID_CODE_LOCAL]\r\n\t,acm.[NPOC]\r\n\t,acm.[NPOC_LOCAL]\r\n\t,acm.[TARGET_CODE]\r\n\t,acm.[SPECSERVICE_ID]\r\n\t,acm.[SPECSERVICE_ID_2]\r\n\t,acm.[SPECSERVICE_ID_3]\r\n\t,acm.[SPECSERVICE_ID_4]\r\n\t,acm.[SPECSERVICE_ID_5]\r\n\t,acm.[SPECSERVICE_ID_6]\r\n\t,acm.[SPECSERVICE_ID_7]\r\n\t,acm.[SPECSERVICE_ID_8]\r\n\t,acm.[SPECSERVICE_ID_9]\r\n\t,acm.[SPECSERVICE_ID_10]\r\n\t,acm.[SPECSERVICE_ID_11]\r\n\t,acm.[SPECSERVICE_ID_12]\r\n\t,acm.[SPECSERVICE_ID_13]\r\n\t,acm.[SPECSERVICE_ID_14]\r\n\t,acm.[SPECSERVICE_ID_15]\r\n\t,acm.[SPECSERVICE_ID_16]\r\n\t,acm.[SPECSERVICE_ID_17]\r\n\t,acm.[SPECSERVICE_ID_18]\r\n\t,acm.[SPECSERVICE_ID_19]\r\n\t,acm.[SPECSERVICE_ID_20]\r\n\t,acm.[SPECSERVICE_ID_21]\r\n\t,acm.[LENGTH_OF_SPELL]\r\n\t,acm.[LENGTH_OF_EPISODE]\r\n\t,acm.[TRIMPOINT_EL]\r\n\t,acm.[TRIMPOINT_NEL]\r\n\t,acm.[EXCESS_BED_DAYS_EL]\r\n\t,acm.[EXCESS_BED_DAYS_NEL]\r\n\t,acm.[EXCESS_BED_DAYS]\r\n\t,acm.[REPORT_MASTER_ID]\r\n\t,acm.[USER_DEFINED_ACTIVITY_CODE_01]\r\n\t,acm.[USER_DEFINED_ACTIVITY_CODE_02]\r\n\t,acm.[USER_DEFINED_ACTIVITY_CODE_03]\r\n\t,acm.[ADMISSION_DATE_TIME]\r\n\t,acm.[ADMISSION_DATE]\r\n\t,acm.[ADMISSION_DATE_ID]\r\n\t,acm.[DISCHARGE_DATE_TIME]\r\n\t,acm.[DISCHARGE_DATE]\r\n\t,acm.[DISCHARGE_DATE_ID]\r\n\t,acm.[EPISODE_START_DATE_TIME]\r\n\t,acm.[EPISODE_START_DATE]\r\n\t,acm.[EPISODE_START_DATE_ID]\r\n\t,acm.[EPISODE_END_DATE_TIME]\r\n\t,acm.[EPISODE_END_DATE]\r\n\t,acm.[EPISODE_END_DATE_ID]\r\n\t,acm.[PATIENT_CLASS_CODE]\r\n\t,acm.[ADMISSION_METHOD_CODE]\r\n\t,acm.[INTENDED_MANAGEMENT_CODE]\r\n\t,acm.[FIRST_REGULAR_DAY_OR_NIGHT_ADMISSION]\r\n\t,acm.[WEIGHT]\r\n\t,acm.[IS_READMISSION]\r\n\t,acm.[READMISSION_DAYS]\r\n\t,acm.[SERVICE_LINE_CODE]\r\n\t,acm.[PERSON_ID]\r\n\t,acm.[HOSPITAL_NUMBER]\r\n\t,acm.[NHS_NUMBER]\r\n\t,acm.[AGE_AT_ACTIVITY_DATE]\r\n\t,acm.[DATE_OF_BIRTH]\r\n\t,acm.[PATIENT_GENDER]\r\n\t,acm.[PATIENT_POSTCODE]\r\n\t,acm.[CLINIC_CODE]\r\n\t,acm.[WARD_CODE_ADMISSION]\r\n\t,acm.[WARD_CODE_DISCHARGE]\r\n\t,acm.[ICD10_CODE]\r\n\t,acm.[OPCS_CODE]\r\n\t,acm.[USER_DEFINED_ACTUAL_ACTIVITY_CODE_01]\r\n\t,acm.[USER_DEFINED_ACTUAL_ACTIVITY_CODE_02]\r\n\t,acm.[USER_DEFINED_ACTUAL_ACTIVITY_CODE_03]\r\n\t,acm.[USER_DEFINED_ACTUAL_ACTIVITY_CODE_04]\r\n\t,acm.[USER_DEFINED_ACTUAL_ACTIVITY_CODE_05]\r\n\t,acm.[PSEUDONYMISED_REPORT_MASTER_ID]\r\n\t,acm.[REFERRAL_SOURCE_CODE]\r\n\t,acm.[PATHWAY_ID]\r\n\t,acm.[SERVICE_CLASS_CODE]\r\n\t,acm.[MOD_FLAG]\r\n\t,acm.[MOD_FLAG_LOCAL]\r\n\t,acm.[JUSTICE_FLAG]\r\n\t,acm.[JUSTICE_FLAG_LOCAL]\r\n\t,acm.[SPECIALIST_FLAG]\r\n\t,acm.[SPECIALIST_FLAG_LOCAL]\r\n\t,acm.[PBR]\r\n\t,acm.[APPOINTMENT_TYPE]\r\n\t,acm.[FIRST_ATTENDANCE_CODE]\r\n\t,acm.[ATTENDED_OR_DID_NOT_ATTEND_CODE]\r\n\t,acm.[PRIMARY_PROCEDURE]\r\n\t,acm.[ALL_PROCEDURES]\r\n\t,acm.[APPOINTMENT_FILTER]\r\n\t,acm.[REPORT_GROUP]\r\n\t,acm.[PRIMARY_DIAGNOSIS]\r\n\t,acm.[ALL_DIAGNOSES]\r\n\t,acm.[CCP_TYPE]\r\n\t,acm.[CRITICAL_CARE_START_DATE_TIME]\r\n\t,acm.[CRITICAL_CARE_START_DATE_ID]\r\n\t,acm.[CRITICAL_CARE_DISCHARGE_DATE_TIME]\r\n\t,acm.[CRITICAL_CARE_DISCHARGE_DATE_ID]\r\n\t,acm.[CRITICAL_CARE_ACTIVITY_DATE]\r\n\t,acm.[CRITICAL_CARE_ACTIVITY_DATE_ID]\r\n\t,acm.[CRITICAL_CARE_UNIT_FUNCTION]\r\n\t,acm.[ALL_CRITICAL_CARE_ACTIVITY_CODES]\r\n\t,null [CRITICAL_CARE_LOCAL_ID]\r\n\t,acm.[OVERSEAS_VISITOR_STATUS]\r\n\t,acm.[STATUS]\r\n\t,acm.[ADMINISTRATIVE_CATEGORY_CODE]\r\n\t,acm.[DATA_QUALITY_FLAG]\r\n\t,acm.[LOCAL_FLAG]\r\n\t,acm.[PATHWAY_TYPE]\r\n\t,acm.[CONSULTANT_NAME]\r\n\t,acm.[CHANGE_LOG]\r\n\t,acm.[WARD_NAME_ADMISSION]\r\n\t,acm.[WARD_NAME_DISCHARGE]\r\n\t,acm.[CRITICAL_CARE_BED_DAYS]\r\n\t,acm.[REHAB_BED_DAYS]\r\n\t,acm.[EXCESS_BED_DAYS_ADJUSTED]\r\n\t,acm.[PRIVATE_PATIENT_FLAG]\r\n\t,acm.[CURRENT_PERMANENT_RESIDENCE_UK_FLAG]\r\n\t,acm.[OVERSEAS_VISITOR_CHARGEABLE_FLAG]\r\n\t,acm.[OVERSEAS_VISITOR_NONCHARGEABLE_FLAG]\r\n\t,acm.[PAYING_PATIENT_FLAG]\r\nFrom\r\n\tinp_ACM_PATIENT_LEVEL_OP acm With(nolock) \r\n\t--Inner Join DW2_Stage..stg_OPHRG_4_201415 hrg On acm.RECORD_ID = hrg.OUTPATIENT_APPOINTMENT_RECORD_ID\r\n\t--Inner Join DW2_Stage..[stg_OPUnbundled_HRG_4_201415] unb On hrg.RowNo = unb.RowNo\r\n\tInner Join CDS_63_OUTPATIENT_MAIN unb On acm.RECORD_ID = unb.RECORD_ID\r\n\r\n\r\n\r\n\r\n\r\n/*\r\n\r\nINSERT INTO INP_ACM_PATIENT_LEVEL_OP_UNB\r\n           (\r\n\t\t   [DATE_ENTERED]\r\n\t\t   ,[RECORD_ID]\r\n           ,[SYSTEM_ID]\r\n           ,[SITE]\r\n           ,[SPECIALTY_CODE_LOCAL]\r\n           ,[SPECIALTY_CODE_SUB]\r\n           ,[CONSULTANT_CODE]\r\n           ,[HA_CODE]\r\n           ,[COMMISSIONER_CODE]\r\n           ,[CONTRACT_CODE]\r\n           ,[POD_CODE_LOCAL]\r\n           ,[REGISTERED_PRACTICE_CODE]\r\n           ,[HRG_CODE]\r\n           ,[ACTIVITY_DATE_TIME]\r\n           ,[ACTIVITY_DATE_ID]\r\n           ,[ACTIVITY_DATE]\r\n           ,[ACTIVITY_VOLUME]\r\n           ,[SLID_CODE]\r\n           ,[TARGET_CODE]\r\n           ,[SPECSERVICE_ID]\r\n           ,[SPECSERVICE_ID_2]\r\n           ,[SPECSERVICE_ID_3]\r\n           ,[SPECSERVICE_ID_4]\r\n           ,[SPECSERVICE_ID_5]\r\n           ,[SPECSERVICE_ID_6]\r\n           ,[SPECSERVICE_ID_7]\r\n           ,[SPECSERVICE_ID_8]\r\n           ,[SPECSERVICE_ID_9]\r\n           ,[SPECSERVICE_ID_10]\r\n           ,[SPECSERVICE_ID_11]\r\n           ,[SPECSERVICE_ID_12]\r\n           ,[SPECSERVICE_ID_13]\r\n           ,[SPECSERVICE_ID_14]\r\n           --,[LOS]\r\n           ,[REPORT_MASTER_ID]\r\n           ,[USER_DEFINED_ACTIVITY_CODE_01]\r\n           ,[USER_DEFINED_ACTIVITY_CODE_02]\r\n           ,[USER_DEFINED_ACTIVITY_CODE_03]\r\n           ,[NPOC]\r\n           ,[ACTIVITY_TREATMENT_FUNCTION_CODE]\r\n\t\t   ,[ADMISSION_DATE_TIME]\r\n\t\t   ,[ADMISSION_DATE]\r\n\t\t   ,[ADMISSION_DATE_ID]\r\n\t\t   ,[DISCHARGE_DATE_TIME]\r\n\t\t   ,[DISCHARGE_DATE]\r\n\t\t   ,[DISCHARGE_DATE_ID]\r\n           ,[PATIENT_CLASS_CODE]\r\n           ,[ADMISSION_METHOD_CODE]\r\n           ,[WEIGHT]\r\n           ,[IS_READMISSION]\r\n           ,[SERVICE_LINE_CODE]\r\n           ,[ORIGINATING_CCG_CODE]\r\n           ,[NHS_NUMBER]\r\n           ,[PATIENT_POSTCODE]\r\n           ,[CLINIC_CODE]\r\n           --,[WARD_CODE]\r\n           ,[ICD10_CODE]\r\n           ,[OPCS_CODE]\r\n           ,[USER_DEFINED_ACTUAL_ACTIVITY_CODE_01]\r\n           ,[USER_DEFINED_ACTUAL_ACTIVITY_CODE_02]\r\n           ,[USER_DEFINED_ACTUAL_ACTIVITY_CODE_03]\r\n           ,[USER_DEFINED_ACTUAL_ACTIVITY_CODE_04]\r\n           ,[USER_DEFINED_ACTUAL_ACTIVITY_CODE_05]\r\n           ,[PSEUDONYMISED_REPORT_MASTER_ID]\r\n           ,[REFERRAL_SOURCE_CODE]\r\n           ,[PATHWAY_ID]\r\n           ,[SPECIALTY_CODE_MAIN]\r\n           ,[SUS_ACTIVITY_ID]\r\n           ,[SERVICE_CLASS_CODE]\r\n\t\t   ,[ACTIVITY_IDENTIFIER]\r\n\t\t   ,[POD_CODE_NHSE]\r\n\t\t   ,[MOD_FLAG]\r\n\t\t   ,[MOD_FLAG_LOCAL]\r\n\t\t   ,[JUSTICE_FLAG]\r\n\t\t   ,[JUSTICE_FLAG_LOCAL]\r\n\t\t   ,[SPECIALIST_FLAG]\r\n\t\t   ,[SPECIALIST_FLAG_LOCAL]\r\n\t\t   ,[PBR]\r\n\t\t   ,[APPOINTMENT_TYPE]\r\n\t\t   ,[FIRST_ATTENDANCE_CODE]\r\n\t\t   ,[ATTENDED_OR_DID_NOT_ATTEND_CODE]\r\n\t\t   ,[PRIMARY_PROCEDURE]\r\n\t\t   ,[ALL_PROCEDURES]\r\n\t\t   )\r\nSelect\r\n\t\t\tGetdate() [DATE_ENTERED]\r\n\t\t\t,a.[RECORD_ID]\r\n           ,a.[SYSTEM_ID]\r\n           ,l07.SITE_CODE_OF_TREATMENT [SITE] --Check This\r\n           ,Null [CONTRACT_SPECIALTY] --\r\n           ,Null [SUB_SPECIALTY]\r\n           ,a.CONSULTANT_CODE_CDS [CONSULTANT_CODE]\r\n           ,Null [HA_CODE]\r\n           ,l06.[ORGANISATION_CODE_CODE_OF_COMMISSIONER] [COMMISSIONER_CODE]\r\n           ,Null [CONTRACT_CODE]\r\n           ,Null [POD_CODE]\r\n           ,a.GENERAL_MEDICAL_PRACTICE_CODE_PATIENT_REGISTRATION [REGISTERED_PRACTICE_CODE]\r\n           --,hrg.NAC_HRG [HRG_CODE]\r\n\t\t   ,unb.UnbundledHRGs [HRG_CODE]\r\n           ,a.ACTIVITY_DATE [ACTIVITY_DATE_TIME]\r\n           ,Convert(Varchar(8),a.ACTIVITY_DATE,112) [ACTIVITY_DATE_ID]\r\n           ,Convert(Varchar(8),a.ACTIVITY_DATE,112) [ACTIVITY_DATE]\r\n           ,1 [ACTIVITY_VOLUME]\r\n           ,pss.ServiceLine [SLID_CODE]\r\n           ,Null [TARGET_CODE]\r\n           ,Null [SPECSERVICE_ID]\r\n           ,Null [SPECSERVICE_ID_2]\r\n           ,Null [SPECSERVICE_ID_3]\r\n           ,Null [SPECSERVICE_ID_4]\r\n           ,Null [SPECSERVICE_ID_5]\r\n           ,Null [SPECSERVICE_ID_6]\r\n           ,Null [SPECSERVICE_ID_7]\r\n           ,Null [SPECSERVICE_ID_8]\r\n           ,Null [SPECSERVICE_ID_9]\r\n           ,Null [SPECSERVICE_ID_10]\r\n           ,Null [SPECSERVICE_ID_11]\r\n           ,Null [SPECSERVICE_ID_12]\r\n           ,Null [SPECSERVICE_ID_13]\r\n           ,Null [SPECSERVICE_ID_14]\r\n           --,Null [LOS]\r\n           ,Null [REPORT_MASTER_ID]\r\n           ,Null [USER_DEFINED_ACTIVITY_CODE_01]\r\n           ,Null [USER_DEFINED_ACTIVITY_CODE_02]\r\n           ,Null [USER_DEFINED_ACTIVITY_CODE_03]\r\n           ,pss.NPOC [NPOC]\r\n           ,a.TREATMENT_FUNCTION_CODE [ACTIVITY_TREATMENT_FUNCTION_CODE]\r\n\t\t   ,a.ACTIVITY_DATE [ADMISSION_DATE_TIME]\r\n\t\t   ,Convert(Varchar(8),a.ACTIVITY_DATE,112) [ADMISSION_DATE]\r\n\t\t   ,Convert(Varchar(8),a.ACTIVITY_DATE,112) [ADMISSION_DATE_ID]\r\n\t\t   ,a.ACTIVITY_DATE [DISCHARGE_DATE_TIME]\r\n\t\t   ,Convert(Varchar(8),a.ACTIVITY_DATE,112) [DISCHARGE_DATE]\r\n\t\t   ,Convert(Varchar(8),a.ACTIVITY_DATE,112) [DISCHARGE_DATE_ID]\r\n           ,Null [PATIENT_CLASS_CODE]\r\n           ,Null [ADMISSION_METHOD_CODE]\r\n           ,Null [WEIGHT]\r\n           ,Null [IS_READMISSION]\r\n           ,Null [SERVICE_LINE_CODE]\r\n           ,Null [ORIGINATING_CCG_CODE]\r\n           ,p.NHS_NUMBER [NHS_NUMBER]\r\n           ,a.POST_CODE_AT_ATTENDANCE_DATE [PATIENT_POSTCODE]\r\n           ,Null [CLINIC_CODE]\r\n           --,Null [WARD_CODE]\r\n           ,Null [ICD10_CODE]\r\n           ,Null [OPCS_CODE]\r\n           ,Null [USER_DEFINED_ACTUAL_ACTIVITY_CODE_01]\r\n           ,Null [USER_DEFINED_ACTUAL_ACTIVITY_CODE_02]\r\n           ,Null [USER_DEFINED_ACTUAL_ACTIVITY_CODE_03]\r\n           ,Null [USER_DEFINED_ACTUAL_ACTIVITY_CODE_04]\r\n           ,Null [USER_DEFINED_ACTUAL_ACTIVITY_CODE_05]\r\n           ,Null [PSEUDONYMISED_REPORT_MASTER_ID]\r\n           ,l05.SOURCE_OF_REFERRAL_FOR_OUT_PATIENTS [REFERRAL_SOURCE_CODE]\r\n           ,l01.PATIENT_PATHWAY_IDENTIFIER [PATHWAY_ID]\r\n           ,a.MAIN_SPECIALTY_CODE [MAIN_SPECIALTY_CODE]\r\n           ,l00.CDS_UNIQUE_ID [SUS_ACTIVITY_ID]\r\n           ,Null [SERVICE_CLASS_CODE]\r\n\t\t   ,a.SOURCE_ID\r\n\t\t   ,Null [NHSE_POD_CODE]\t\t   \r\n\t\t   ,[MOD_FLAG]\r\n\t\t   ,Null [MOD_FLAG_LOCAL]\r\n\t\t   ,[JUSTICE_FLAG]\r\n\t\t   ,Null [JUSTICE_FLAG_LOCAL]\r\n\t\t   ,a.SPECIALIST_COMMISSIONING_FLAG [SPECIALIST_FLAG]\r\n\t\t   ,Null [SPECIALIST_FLAG_LOCAL]\r\n\t\t   ,1 [PBR]\r\n\t\t   ,a.APPOINTMENT_TYPE [APPOINTMENT_TYPE]\r\n\t\t   ,A.FIRST_ATTENDANCE_CODE [FIRST_ATTENDANCE_CODE]\r\n\t\t   ,l05.ATTENDED_OR_DID_NOT_ATTEND_CODE [ATTENDED_OR_DID_NOT_ATTEND_CODE]\r\n\t\t   ,pr.PROCEDURE_01 [PRIMARY_PROCEDURE]\r\n\t\t   ,Isnull(pr.PROCEDURE_01,'') + '|' + Isnull(pr.PROCEDURE_02,'') + '|' + Isnull(pr.PROCEDURE_03,'') + '|' + Isnull(pr.PROCEDURE_04,'') + '|' + Isnull(pr.PROCEDURE_05,'') + '|'\r\n\t\t    + Isnull(pr.PROCEDURE_06,'') + '|' + Isnull(pr.PROCEDURE_07,'') + '|' + Isnull(pr.PROCEDURE_08,'') + '|' + Isnull(pr.PROCEDURE_09,'') + '|' + Isnull(pr.PROCEDURE_10,'') + '|'\r\n\t\t\t+ Isnull(pr.PROCEDURE_11,'') + '|' + Isnull(pr.PROCEDURE_12,'') + '|' + Isnull(pr.PROCEDURE_13,'') + '|' + Isnull(pr.PROCEDURE_14,'') + '|' + Isnull(pr.PROCEDURE_15,'') + '|'\r\n\t\t\t+ Isnull(pr.PROCEDURE_16,'') + '|' + Isnull(pr.PROCEDURE_17,'') + '|' + Isnull(pr.PROCEDURE_18,'') + '|' + Isnull(pr.PROCEDURE_19,'') + '|' + Isnull(pr.PROCEDURE_20,'') + '|' [ALL_PROCEDURES]\r\nFrom\r\n\tBedrock.outp.OUTPATIENT_APPOINTMENT a\r\n\tLeft Join Bedrock.outp.OUTPATIENT_APPOINTMENT_PROCEDURE_SR pr On a.RECORD_ID = pr.OUTPATIENT_APPOINTMENT_RECORD_ID\r\n\tInner Join Bedrock.outp.PATIENT p On a.PATIENT_RECORD_ID = p.RECORD_ID\r\n\tInner Join DW2_Stage..stg_OPHRG_4_201415 hrg On a.RECORD_ID = hrg.OUTPATIENT_APPOINTMENT_RECORD_ID\r\n\tInner Join DW2_Stage..[stg_OPUnbundled_HRG_4_201415] unb On hrg.RowNo = unb.RowNo\r\n\tLeft Join DW2_Stage..stg_OPPSS_201415 pss On a.RECORD_ID = pss.OUTPATIENT_APPOINTMENT_RECORD_ID\r\n\tInner Join Bedrock.outp.CDS_020_OPS_62_00_TRANSACTION_HEADER l00 On a.RECORD_ID = l00.RECORD_JOIN_ID\r\n\tLeft Join Bedrock.outp.CDS_020_OPS_62_01_PATIENT_PATHWAY l01 On a.RECORD_ID = l01.RECORD_ID\r\n\tInner Join Bedrock.outp.CDS_020_OPS_62_02_PATIENT_IDENTITY l02 On a.RECORD_ID = l02.RECORD_ID\r\n\tInner Join Bedrock.outp.CDS_020_OPS_62_05_ACTIVITY_CHARACTERISTICS l05 On a.RECORD_ID = l05.RECORD_ID\r\n\tInner Join Bedrock.outp.CDS_020_OPS_62_06_ATTENDANCE_OCCURENCE_SERVICE_AGREEMENT l06 On a.RECORD_ID = l06.RECORD_ID\r\n\tInner Join Bedrock.outp.CDS_020_OPS_62_07_LOCATION_GROUP_ATTENDANCE l07 On a.RECORD_ID = l07.RECORD_JOIN_ID\r\nWhere\r\n\ta.ACTIVITY_DATE >= '20150401'\r\n\tAnd a.ACTIVITY_DATE < '20160301'\r\n\r\n--Remove Extra Pipes\r\nUpdate a\r\nSet\r\n\t[ALL_PROCEDURES] = Left([ALL_PROCEDURES],Charindex('||',[ALL_PROCEDURES])-1)\r\n--Select\r\n--\tLeft([ALL_PROCEDURES],Charindex('||',[ALL_PROCEDURES])-1)\r\n--\t,ALL_PROCEDURES\r\nFrom\r\n\tACM_PATIENT_LEVEL_OP_UNB a\r\n\r\nUpdate a\r\nSet\r\n\t[ALL_PROCEDURES] = NullIf([ALL_PROCEDURES],'')\r\n--Select\r\n--\tLeft([ALL_PROCEDURES],Charindex('||',[ALL_PROCEDURES])-1)\r\n--\t,ALL_PROCEDURES\r\nFrom\r\n\tACM_PATIENT_LEVEL_OP_UNB a\r\n\r\n--Contract Code\r\n--update sd\r\n--set \r\n--\tCONTRACT_CODE = c.CCG_CODE\r\n--from \r\n--\t--inp.a_and_E_attendance a \r\n--\tINP_ACM_PATIENT_LEVEL_OP_UNB sd\r\n--\tInner Join Bedrock.outp.OUTPATIENT_APPOINTMENT a on sd.RECORD_ID = a.RECORD_ID\r\n--\tinner join [RBHDWHRED001].Local_Reference_DB.ref.local_contract c on ae.ORGANISATION_CODE_CODE_OF_COMMISSIONER = c.CCG_CODE\r\n--\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAnd sd.ACTIVITY_DATE Between c.EFFECTIVE_START And c.EFFECTIVE_END\r\n\r\n--Contract Code\r\nupdate sd\r\nset \r\n\tCONTRACT_CODE = Isnull(c.CCG_CODE,'9XX')\r\nfrom \r\n\t--inp.a_and_E_attendance a \r\n\tINP_ACM_PATIENT_LEVEL_OP_UNB sd\r\n\tInner Join Bedrock.outp.OUTPATIENT_APPOINTMENT a on sd.RECORD_ID = a.RECORD_ID\r\n\tInner Join Bedrock.outp.CDS_020_OPS_62_06_ATTENDANCE_OCCURENCE_SERVICE_AGREEMENT l06 On a.RECORD_ID = l06.RECORD_JOIN_ID\r\n\tLeft join [RBHDWHRED001].Local_Reference_DB.ref.local_contract c on Left(l06.ORGANISATION_CODE_CODE_OF_COMMISSIONER,3) = Left(c.CCG_CODE,3)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAnd sd.ACTIVITY_DATE Between c.EFFECTIVE_START And c.EFFECTIVE_END\r\n\r\n--Select * From ReferenceDB..Postcode\r\n--HA Code\r\nupdate sd\r\nset \r\n\tHA_CODE = p.Strategic_Health_Authority\r\n--\t,ORIGINATING_CCG_CODE = Isnull(c.High_Level_Health_Authority_Code,p.Strategic_Health_Authority)\r\nfrom \r\n\t--inp.a_and_E_attendance a \r\n\tINP_ACM_PATIENT_LEVEL_OP_UNB sd\r\n\tInner Join Bedrock.outp.OUTPATIENT_APPOINTMENT a on sd.RECORD_ID = a.RECORD_ID\r\n\tLeft Join ReferenceDB..Postcode p On REPLACE(a.POST_CODE_AT_ATTENDANCE_DATE,' ','') = p.POSTCODE_NO_SPACE\r\n\t\t\t\t\t\t\t\t\t\tAnd a.ACTIVITY_DATE >= p.Effective_From\r\n\t\t\t\t\t\t\t\t\t\tAnd a.ACTIVITY_DATE < Isnull(p.Effective_To,'20990101')\r\n\t--Left Join ReferenceDB.dbo.Commissioner c On ae.ORGANISATION_CODE_RESIDENCE_RESPONSIBILITY = c.Commissioner_Org_Code\r\n\t--Inner Join ReferenceDB.dbo.Commissioner c On ae.ORGANISATION_CODE_CODE_OF_COMMISSIONER = c.Commissioner_Org_Code\r\n\r\n--Originating CCG Code\r\nupdate sd\r\nset \r\n\tORIGINATING_CCG_CODE = Isnull(c.High_Level_Health_Authority_Code,c.Commissioner_Org_Code)\r\n--Select c.*\r\nfrom \r\n\t--inp.a_and_E_attendance a \r\n\tINP_ACM_PATIENT_LEVEL_OP_UNB sd\r\n\tInner Join Bedrock.outp.OUTPATIENT_APPOINTMENT ae on sd.RECORD_ID = ae.RECORD_ID\r\n\tInner Join Bedrock.outp.CDS_020_OPS_62_06_ATTENDANCE_OCCURENCE_SERVICE_AGREEMENT l06 On ae.RECORD_ID = l06.RECORD_JOIN_ID\r\n\tLeft Join ReferenceDB.dbo.Commissioner c On Left(l06.ORGANISATION_CODE_CODE_OF_COMMISSIONER,3) = Left(c.Commissioner_Org_Code,3)\r\n\r\nupdate sd\r\nset \r\n\tORIGINATING_CCG_CODE = Left(l06.ORGANISATION_CODE_CODE_OF_COMMISSIONER,3)\r\n--Select c.*\r\nfrom \r\n\t--inp.a_and_E_attendance a \r\n\tINP_ACM_PATIENT_LEVEL_OP_UNB sd\r\n\tInner Join Bedrock.outp.OUTPATIENT_APPOINTMENT ae on sd.RECORD_ID = ae.RECORD_ID\r\n\tInner Join Bedrock.outp.CDS_020_OPS_62_06_ATTENDANCE_OCCURENCE_SERVICE_AGREEMENT l06 On ae.RECORD_ID = l06.RECORD_JOIN_ID\r\n\tLeft Join ReferenceDB.dbo.Commissioner c On Left(l06.ORGANISATION_CODE_CODE_OF_COMMISSIONER,3) = Left(c.Commissioner_Org_Code,3)\r\nWhere\r\n\tORIGINATING_CCG_CODE Is null\r\n\tAnd Left(l06.ORGANISATION_CODE_CODE_OF_COMMISSIONER,3) Like 'Q%'\r\n\r\n--Errors\r\nupdate sd\r\nset \r\n\tORIGINATING_CCG_CODE = '!!'\r\n--Select c.*\r\nfrom \r\n\t--inp.a_and_E_attendance a \r\n\tINP_ACM_PATIENT_LEVEL_OP_UNB sd\r\n\tInner Join Bedrock.outp.OUTPATIENT_APPOINTMENT ae on sd.RECORD_ID = ae.RECORD_ID\r\n\tInner Join Bedrock.outp.CDS_020_OPS_62_06_ATTENDANCE_OCCURENCE_SERVICE_AGREEMENT l06 On ae.RECORD_ID = l06.RECORD_JOIN_ID\r\n\tLeft Join ReferenceDB.dbo.Commissioner c On Left(l06.ORGANISATION_CODE_CODE_OF_COMMISSIONER,3) = Left(c.Commissioner_Org_Code,3)\r\nWhere\r\n\tORIGINATING_CCG_CODE Is null\r\n\r\n\r\n--Service Class Code\r\n--Errors\r\nupdate sd\r\nset \r\n\tSERVICE_CLASS_CODE = Case When MOD_FLAG = 1 Then 'AF'\r\n\t\t\t\t\t\t\t\tWhen JUSTICE_FLAG = 1 Then 'HJ'\r\n\t\t\t\t\t\t\t\tWhen SPECIALIST_FLAG = 1 Then 'SS'\r\n\t\t\t\t\t\t\tElse\r\n\t\t\t\t\t\t\t\t'99'\r\n\t\t\t\t\t\t\tEnd\r\n--Select c.*\r\nfrom \r\n\t--inp.a_and_E_attendance a \r\n\tINP_ACM_PATIENT_LEVEL_OP_UNB sd\r\n\r\n\r\n--Where sd.RECORD_ID = 5000000274527\r\n\r\n--select * From ReferenceDB.dbo.Commissioner where Commissioner_Org_Code like 'q%'\r\n\r\n--select * From Bedrock.outp.CDS_020_OPS_62_06_ATTENDANCE_OCCURENCE_SERVICE_AGREEMENT\r\n\r\n--Select * From ReferenceDB..GP_GDP_PRACTICE\r\n--Select * From ReferenceDB..GPPractice where Organisation_Code = 's63438'\r\n\r\n\r\n\r\n--Select * From ReferenceDB..Commissioner\r\n\r\n--ACTIVITY_TYPE\r\n--update sd\r\n--set \r\n--\tACTIVITY_TYPE = 'AandE'\r\n--from \r\n--\t--inp.a_and_E_attendance a \r\n--\tINP_ACM_PATIENT_LEVEL_OP_UNB sd\r\n\r\n/*\r\n--Contract Specialty\r\nupdate sd\r\nset SPECIALTY_CODE_LOCAL = CASE WHEN A_AND_E_DEPARTMENT_TYPE = '01' THEN 'AE' ELSE 'CA130' END\r\nfrom \r\n\t--inp.a_and_E_attendance a \r\n\tINP_ACM_PATIENT_LEVEL_OP_UNB sd\r\n\tInner Join Bedrock.outp.OUTPATIENT_APPOINTMENT ae on sd.RECORD_ID = ae.RECORD_ID\r\n*/\r\n--POD Code\r\nupdate sd\r\nset \r\n\tPOD_CODE_LOCAL = Case \r\n\t\t\t\t\t\tWhen HRG_CODE = 'WF01A' Then 'OPFUPSPCL'\r\n\t\t\t\t\t\tWhen HRG_CODE = 'WF01B' Then 'OPFASPCL'\r\n\t\t\t\t\t\tWhen HRG_CODE = 'WF01C' Then 'NFTF'\r\n\t\t\t\t\t\tWhen HRG_CODE = 'WF01D' Then 'NFTF'\r\n\t\t\t\t\t\tWhen HRG_CODE = 'WF02A' Then 'OPFUPMPCL'\r\n\t\t\t\t\t\tWhen HRG_CODE = 'WF02B' Then 'OPFAMPCL'\r\n\t\t\t\t\t\tWhen HRG_CODE = 'WF02C' Then 'NFTF'\r\n\t\t\t\t\t\tWhen HRG_CODE = 'WF02D' Then 'NFTF'\r\n\t\t\t\t\tElse\r\n\t\t\t\t\t\t'Other'\r\n\t\t\t\t\tEnd\r\n\t\t\t\t\t\t\r\n\t,POD_CODE_NHSE = Case \r\n\t\t\t\t\t\tWhen HRG_CODE = 'WF01A' Then 'OPFUPSPCL'\r\n\t\t\t\t\t\tWhen HRG_CODE = 'WF01B' Then 'OPFASPCL'\r\n\t\t\t\t\t\tWhen HRG_CODE = 'WF01C' Then 'NFTF'\r\n\t\t\t\t\t\tWhen HRG_CODE = 'WF01D' Then 'NFTF'\r\n\t\t\t\t\t\tWhen HRG_CODE = 'WF02A' Then 'OPFUPMPCL'\r\n\t\t\t\t\t\tWhen HRG_CODE = 'WF02B' Then 'OPFAMPCL'\r\n\t\t\t\t\t\tWhen HRG_CODE = 'WF02C' Then 'NFTF'\r\n\t\t\t\t\t\tWhen HRG_CODE = 'WF02D' Then 'NFTF'\r\n\t\t\t\t\tElse\r\n\t\t\t\t\t\t'Other'\r\n\t\t\t\t\tEnd\r\nfrom \r\n\t--inp.a_and_E_attendance a \r\n\tINP_ACM_PATIENT_LEVEL_OP_UNB sd\r\n\r\n\r\n\r\n\r\n\r\n\r\n \r\n \r\nSelect Top 1000 * From ACM_PATIENT_LEVEL_OP_UNB-- where ORIGINATING_CCG_CODE is null\r\n--Select * From ReferenceDB..Postcode where POSTCODE_NO_SPACE in(Select PATIENT_POSTCODE From SLAM_detail where HA_CODE is null)\r\n\r\n--Select * From [RBHDWHRED001].Local_Reference_DB.ref.local_contract\r\n/*\r\nSelect\t\r\n\t* \r\nFrom \r\n\tBedrock.INFORMATION_SCHEMA.COLUMNS\r\nWhere \r\n\t(TABLE_NAME Like '%020%'\r\n\tOr TABLE_NAME Like 'outpatient_appointment')\r\n\tAnd COLUMN_NAME Like '%pathway%'\r\n*/\r\n\r\n--Needed From Cerner\r\n--Primary and Secondary Procedures\r\n\r\n--Select * From bedrock.outp.OUTPATIENT_APPOINTMENT_PROCEDURE_SR\r\n*/"}